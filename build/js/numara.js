/**
 * @copyright 2021 Timur Atalay
 * @homepage https://github.com/bornova/numara-calculator
 * @license MIT - https://github.com/bornova/numara-calculator/blob/master/LICENSE
 */

appInfo = {
    productName: 'Numara',
    description:'Numara Calculator',
    version: '3.7.0',
    author: 'Timur Atalay',
    homepage: 'https://github.com/bornova/numara-calculator',
    licence: 'MIT',
    website: 'https://numara.io'
};
(()=>{const e=e=>document.getElementById(e),t=e=>JSON.parse(localStorage.getItem(e)),a=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},n=luxon.DateTime;feather.replace();const o=CodeMirror.fromTextArea(e("inputArea"),{theme:"numara",coverGutterNextToScrollbar:!0,inputStyle:"textarea",viewportMargin:1/0});o.setValue(t("input")||""),o.execCommand("goDocEnd"),e("udfInput").setAttribute("placeholder",'// Define new functions and variables:\n    myvalue: 42,\n    hello: (name) => {\n    \treturn "hello, " + name + "!"\n    }'.replace(/^ +/gm,""));const i=CodeMirror.fromTextArea(e("udfInput"),{mode:"javascript",autoCloseBrackets:!0,smartIndent:!1});e("uduInput").setAttribute("placeholder",'// Define new units:\n    foo: {\n    \tprefixes: "long",\n    \tbaseName: "essence-of-foo"\n    },\n    bar: "40 foo",\n    baz: {\n    \tdefinition: "1 bar/hour",\n    \tprefixes: "long"\n    }'.replace(/^ +/gm,""));const r=CodeMirror.fromTextArea(e("uduInput"),{mode:"javascript",autoCloseBrackets:!0,smartIndent:!1}),s=navigator.userAgent.toLowerCase().includes("mac"),c=navigator.userAgent.toLowerCase().includes("electron"),l=c?require("electron").ipcRenderer:null;function p(){l.send(l.sendSync("isMaximized")?"unmaximize":"maximize")}let d;document.title=appInfo.description,e("dialog-about-title").innerHTML=appInfo.description,e("dialog-about-copyright").innerHTML=`Copyright ©️ ${n.local().year} ${appInfo.author}`,e("dialog-about-appVersion").innerHTML=c?"Version "+appInfo.version:`Version ${appInfo.version}\n    <div class="versionCtnr">\n      <div>\n        <a href="https://github.com/bornova/numara-calculator/releases" target="_blank">Download desktop version</a>\n      </div>\n    </div>`,e("gitLink").setAttribute("href",appInfo.homepage),e("webLink").setAttribute("href",appInfo.website),e("licenseLink").setAttribute("href",appInfo.homepage+"/blob/master/LICENSE"),c?(l.on("themeUpdate",B),l.on("fullscreen",((e,t)=>{t&&l.send("maximize")}))):"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").catch((()=>{console.log("Service worker registration failed")})),c&&!s?(e("header-mac").remove(),e("header-win").style.display="block",e("header-win-title").innerHTML=appInfo.productName,e("max").style.display=l.sendSync("isMaximized")?"none":"block",e("unmax").style.display=l.sendSync("isMaximized")?"block":"none",e("winButtons").addEventListener("click",(e=>{switch(e.target.id){case"min":l.send("minimize");break;case"max":l.send("maximize");break;case"unmax":l.send("unmaximize");break;case"close":l.send("close")}e.stopPropagation()})),l.on("isMax",((t,a)=>{e("unmax").style.display=a?"block":"none",e("max").style.display=a?"none":"block"})),e("header-win").addEventListener("dblclick",p)):(e("header-win").remove(),e("header-mac").style.display="block",e("header-mac-title").innerHTML=appInfo.productName,c&&e("header-mac").addEventListener("dblclick",p));const u={app:{autocomplete:!0,closeBrackets:!0,contPrevLine:!0,currencies:!0,dateDay:!1,dateFormat:"M/d/yyyy",divider:!0,fontSize:"1.1rem",fontWeight:"400",keywordTips:!0,lineErrors:!0,lineNumbers:!0,lineWrap:!0,matchBrackets:!0,matrixType:"Matrix",numericOutput:"number",precision:"4",predictable:!1,syntax:!0,theme:"system",thouSep:!0,timeFormat:"h:mm a"},inputWidth:60,plot:{plotArea:!1,plotCross:!1,plotGrid:!1}};d=t("settings"),d?DeepDiff.observableDiff(d,u,(e=>{"E"!==e.kind&&(DeepDiff.applyChange(d,u,e),a("settings",d))})):(d=u,a("settings",u)),math.createUnit("USD",{aliases:["usd"]});let m={};function h(){navigator.onLine?(e("lastUpdated").innerHTML='<div uk-spinner="ratio: 0.3"></div>',fetch("https://www.floatrates.com/widget/1030/cfc5515dfc13ada8d7b0e50b8143d55f/usd.json").then((e=>e.json())).then((n=>{m=n;const o=["cup"];Object.keys(n).forEach((e=>{math.createUnit(n[e].code,{definition:math.unit(n[e].inverseRate+"USD"),aliases:[o.includes(n[e].code.toLowerCase())?"":n[e].code.toLowerCase()]},{override:!0}),a("rateDate",n[e].date)})),B(),e("lastUpdated").innerHTML=t("rateDate")})).catch((t=>{e("lastUpdated").innerHTML="n/a",P("Failed to get exchange rates ("+t+")","warning")}))):(e("lastUpdated").innerHTML="No internet connection.",P("No internet connection. Could not update exchange rates.","warning"))}function g(){let t=[];const i=[],r=[],s=[],c={},l={},p={lowerExp:-12,upperExp:12},u={maximumFractionDigits:d.app.precision};function m(e){l.avg=math.evaluate(i.length>0?"("+math.mean(i)+")":0),l.total=math.evaluate(r.length>0?"("+r.join("+")+")":0),l.subtotal=math.evaluate(s.length>0?"("+s.join("+")+")":0);const t=(e=e.replace(/\bans\b/g,c.ans).replace(/\bnow\b/g,c.now).replace(/\btoday\b/g,c.today).replace(/\bavg\b/g,l.avg).replace(/\btotal\b/g,l.total).replace(/\bsubtotal\b/g,l.subtotal)).match(/\bline\d+\b/g);t&&t.forEach((t=>{e=e.replace(t,c[t])}));if(e.match(/'millisecond|second|minute|hour|day|week|month|quarter|year|decade|century|centuries|millennium|millennia'/g)){const t=e.split(/[+-]/),a=t[0].replace(/[A-Za-z]+,/,"").trim(),o=e.replace(t[0],"").trim(),i=d.app.dateFormat,r=d.app.dateFormat+" "+d.app.timeFormat,s=n.fromFormat(a,i),l=n.fromFormat(a,r),p=s.isValid?s:l.isValid?l:null,u=String(math.evaluate(o+" to hours",c)),m=Number(u.split(" ")[0]);if(!p)return"Invalid Date";{const t=p.toFormat(d.app.dateFormat+"hh:mm:ss:SSS").endsWith("12:00:00:000");e='"'+p.plus({hours:m}).toFormat((d.app.dateDay?"ccc, ":"")+(t?i:r))+'"'}}return e=e.match(/[\w.]*%[ ]*of[ ]*/g)?e.replace(/%[ ]*of[ ]*/g,"/100*"):e,math.evaluate(e,c)}c.now=n.local().toFormat((d.app.dateDay?"ccc, ":"")+d.app.dateFormat+" "+d.app.timeFormat),c.today=n.local().toFormat((d.app.dateDay?"ccc, ":"")+d.app.dateFormat),o.refresh(),o.eachLine((e=>{const a=o.getLineNumber(e),n=a+1,l=e.height;let h="",g=e.text.trim().split("//")[0].split("#")[0];if(o.removeLineClass(a,"gutter","lineNoError"),g)try{g=n>1&&g.charAt(0).match(/[+\-*/]/)&&o.getLine(n-2).length>0&&d.app.contPrevLine?c.ans+g:g;try{h=math.evaluate(g,c)}catch(e){if(g.match(/:/))try{math.evaluate(g.split(":")[0])}catch(e){g=g.substring(g.indexOf(":")+1)}for(;g.match(/\([^)]+\)/);){let e=g.substring(g.lastIndexOf("(")+1),t=g.substring(g.lastIndexOf("("));if(e=e.substring(0,e.indexOf(")")),t=t.substring(0,t.indexOf(")")+1),0===t.length)break;try{g=g.replace(t,m(e))}catch(e){break}}h=m(g)}if(void 0!==h){if(c.ans=h,c["line"+n]=h,isNaN(h)||(i.push(h),r.push(h),s.push(h)),h=function(e){const t=(e=String(e)).trim().split(" ")[0],a=e.replace(t,"");return t.includes("e")||isNaN(t)?t.match(/e-?\d+/)?parseFloat(Number(t.split("e")[0]).toFixed(d.app.precision))+"e"+e.split("e")[1]+a:function(e){let t=e.length;'"'===e.charAt(0)&&(e=e.substring(1,t--));'"'===e.charAt(--t)&&(e=e.substring(0,t));return e}(e):d.app.thouSep?Number(t).toLocaleString(void 0,u)+a:parseFloat(Number(t).toFixed(d.app.precision))+a}(math.format(h,p)),h.match(/\w\(x\)/)){const e=/\w\(x\)$/.test(h)?g.trim():h.trim();h=`<a class="plotButton" data-func="${e}">Plot</a>`,c.ans=e,c["line"+n]=e}}else s.length=0,h=""}catch(e){const t=String(e).replace(/'|"/g,"`");h=d.app.lineErrors?`<a class="lineError" data-line="${n}" data-error="${t}">Error</a>`:"",d.app.lineErrors&&o.addLineClass(a,"gutter","lineNoError")}else s.length=0;t+=`\n      <div style="height:${l}px">\n        <span class="${h&&!h.startsWith("<a")?"answer":""}" >${h}</span>\n      </div>`})),e("output").innerHTML=t,e("clearButton").className=""===o.getValue()?"noAction":"action",e("printButton").className=""===o.getValue()?"noAction":"action",e("saveButton").className=""===o.getValue()?"noAction":"action",a("input",o.getValue())}const f=[],y=[];function k(t){try{new Function(`'use strict'; math.import({${t}}, {override: true})`)(),g(),a("udf",t);const e=new Function(`'use strict'; return {${t}}`)();for(const t in e)f.push(t);UIkit.modal("#dialog-udfu").hide()}catch(t){e("udfSyntaxError").innerHTML=t}}function v(t){try{new Function(`'use strict'; math.createUnit({${t}}, {override: true})`)(),g(),a("udu",t);const e=new Function(`'use strict'; return {${t}}`)();for(const t in e)y.push(t);UIkit.modal("#dialog-udfu").hide()}catch(t){e("uduSyntaxError").innerHTML=t}}UIkit.util.on("#dialog-udfu","beforeshow",(()=>{e("udfSyntaxError").innerHTML="",e("uduSyntaxError").innerHTML="";const a=t("udf").trim(),n=t("udu").trim();i.setValue(a),r.setValue(n)})),UIkit.util.on("#dialog-udfu","shown",(()=>{i.refresh(),r.refresh()})),t("udf")||a("udf",""),t("udu")||a("udu",""),k(t("udf")),v(t("udu")),CodeMirror.defineMode("numara",(()=>({token:(e,t)=>{if(e.match(/\/\/.*/)||e.match(/#.*/))return"comment";if(e.match(/\d/))return"number";if(e.match(/(?:\+|-|\*|\/|,|;|\.|:|@|~|=|>|<|&|\||_|`|'|\^|\?|!|%)/))return"operator";e.eatWhile(/\w/);const a=e.current();if(d.app.currencies&&(a.toLowerCase()in m||"usd"===a.toLowerCase()))return"currency";try{if(math.unit(a).units.length>0)return"unit"}catch(e){}if(f.includes(a))return"udf";if(y.includes(a))return"udu";if("function"==typeof math[a]&&Object.getOwnPropertyNames(math[a]).includes("signatures"))return"function";if(a.match(/\b(?:ans|total|subtotal|avg|today|now|line\d+)\b/))return"scope";try{math.evaluate(a)}catch(e){return"variable"}return e.next(),"space"}}))),CodeMirror.defineMode("plain",(()=>({token:(e,t)=>(e.next(),"text")})));const b=["ans","now","today","total","subtotal","avg"];function B(){d=t("settings"),e("style").setAttribute("href","system"===d.app.theme?c&&l.sendSync("isDark")?"css/dark.css":"css/light.css":"light"===d.app.theme?"css/light.css":"css/dark.css"),c&&l.send("setTheme",d.app.theme);const a=document.querySelectorAll(".panelFont, .CodeMirror");for(const e of a)e.style.fontSize=d.app.fontSize,e.style.fontWeight=d.app.fontWeight;e("input").style.width=(d.app.divider?d.inputWidth:u.inputWidth)+"%",e("divider").style.display=d.app.divider?"block":"none",e("output").style.textAlign=d.app.divider?"left":"right",o.setOption("mode",d.app.syntax?"numara":"plain"),o.setOption("lineNumbers",d.app.lineNumbers),o.setOption("lineWrapping",d.app.lineWrap),o.setOption("autoCloseBrackets",d.app.closeBrackets),o.setOption("matchBrackets",!(!d.app.syntax||!d.app.matchBrackets)&&{maxScanLines:1});const n="system"===d.app.theme?c&&l.sendSync("isDark")?"material-darker":"default":"light"===d.app.theme?"default":"material-darker";i.setOption("theme",n),r.setOption("theme",n),math.config({matrix:d.app.matrixType,number:d.app.numericOutput,predictable:d.app.predictable}),setTimeout(g,15)}function L(e){UIkit.modal(e,{bgClose:!1,stack:!0}).show()}Object.getOwnPropertyNames(math).forEach((e=>{"function"==typeof math[e]&&Object.getOwnPropertyNames(math[e]).includes("signatures")&&b.push(e)})),CodeMirror.registerHelper("hint","numaraHints",(e=>{const t=e.getCursor(),a=e.getLine(t.line);let n=t.ch,o=n;for(;o<a.length&&/[\w$]/.test(a.charAt(o));)++o;for(;n&&/[\w$]/.test(a.charAt(n-1));)--n;const i=n!==o&&a.slice(n,o),r=new RegExp("^"+i,"i");return{list:(i?b.filter((e=>e.match(r))):[]).sort(),from:CodeMirror.Pos(t.line,n),to:CodeMirror.Pos(t.line,o)}})),CodeMirror.commands.autocomplete=e=>{CodeMirror.showHint(e,CodeMirror.hint.numaraHints,{completeSingle:!1})},o.on("changes",g),o.on("inputRead",((e,t)=>{d.app.autocomplete&&CodeMirror.commands.autocomplete(e)})),o.on("update",(()=>{const e=document.getElementsByClassName("cm-function");if(e.length>0&&d.app.keywordTips)for(const t of e)try{const e=JSON.stringify(math.help(t.innerHTML).toJSON()),a=JSON.parse(e);UIkit.tooltip(t,{title:a.description,pos:"top-left"})}catch(e){UIkit.tooltip(t,{title:"Description not available.",pos:"top-left"})}const t=document.getElementsByClassName("cm-udf");if(t.length>0&&d.app.keywordTips)for(const e of t)UIkit.tooltip(e,{title:"User defined function.",pos:"top-left"});const a=document.getElementsByClassName("cm-udu");if(a.length>0&&d.app.keywordTips)for(const e of a)UIkit.tooltip(e,{title:"User defined unit.",pos:"top-left"});const n=document.getElementsByClassName("cm-currency");if(n.length>0&&d.app.keywordTips)for(const e of n)try{const t=e.innerHTML.toLowerCase(),a="usd"===t?"U.S. Dollar":m[t].name;UIkit.tooltip(e,{title:a,pos:"top-left"})}catch(t){UIkit.tooltip(e,{title:"Description not available.",pos:"top-left"})}const o=document.getElementsByClassName("cm-unit");if(o.length>0&&d.app.keywordTips)for(const e of o)UIkit.tooltip(e,{title:`Unit '${e.innerHTML}'`,pos:"top-left"})})),B(),d.app.currencies&&h(),UIkit.mixin({data:{delay:500,offset:5}},"tooltip"),UIkit.util.on(".modal","hidden",(()=>{o.focus()})),UIkit.util.on(".uk-switcher","show",(()=>{o.getInputField().blur()}));const w=()=>Object.keys(t("saved")||{}).length;function x(){UIkit.tooltip("#openButton",{title:"Open ("+w()+")"})}function T(){const a=t("saved")||{},o=Object.entries(a);e("dialog-open-body").innerHTML="",o.length>0?(e("dialog-open-deleteAll").disabled=!1,o.forEach((([t,a])=>{e("dialog-open-body").innerHTML+=`\n        <div class="dialog-open-wrapper" id="${t}">\n          <div data-action="load">\n            <div class="dialog-open-title">${a[0]}</div>\n            <div class="dialog-open-date">${n.fromFormat(t,"yyyyMMddHHmmssSSS").toFormat("ff")}</div>\n          </div>\n          <span class="dialog-open-delete" data-action="delete"><i data-feather="x-circle"></i></span>\n        </div>`})),feather.replace()):(e("dialog-open-deleteAll").disabled=!0,e("dialog-open-body").innerHTML="No saved calculations.",e("openButton").className="noAction"),x()}function M(){const a=["M/d/yyyy","d/M/yyyy","MMM d, yyyy"],o=["h:mm a","H:mm"],i=["Matrix","Array"],r=["number","BigNumber","Fraction"];e("themeList").value=d.app.theme,e("fontSize").value=d.app.fontSize,e("fontWeight").value=d.app.fontWeight,e("dateFormat").innerHTML="";for(const t of a)e("dateFormat").innerHTML+=`<option value="${t}">${n.local().toFormat(t)}</option>`;e("dateFormat").value=d.app.dateFormat,e("timeFormat").innerHTML="";for(const t of o)e("timeFormat").innerHTML+=`<option value="${t}">${n.local().toFormat(t)}</option>`;e("timeFormat").value=d.app.timeFormat,e("dateDay").checked=d.app.dateDay,e("syntaxButton").checked=d.app.syntax,E(),e("keywordTipsButton").checked=d.app.keywordTips,e("matchBracketsButton").checked=d.app.matchBrackets,e("precisionRange").value=d.app.precision,e("precision-label").innerHTML=d.app.precision,e("numericOutput").innerHTML="";for(const t of r)e("numericOutput").innerHTML+=`<option value="${t}">${t.charAt(0).toUpperCase()+t.slice(1)}</option>`;e("numericOutput").value=d.app.numericOutput,"BigNumber"===d.app.numericOutput&&I(),e("contPrevLineButton").checked=d.app.contPrevLine,e("matrixType").innerHTML="";for(const t of i)e("matrixType").innerHTML+=`<option value="${t}">${t}</option>`;e("matrixType").value=d.app.matrixType,e("predictableButton").checked=d.app.predictable,e("thouSepButton").checked=d.app.thouSep,e("currencyButton").checked=d.app.currencies,e("lastUpdated").innerHTML=d.app.currencies?t("rateDate"):"",e("currencyUpdate").style.display=d.app.currencies?"block":"none",e("autocompleteButton").checked=d.app.autocomplete,e("closeBracketsButton").checked=d.app.closeBrackets,e("dividerButton").checked=d.app.divider,e("lineNoButton").checked=d.app.lineNumbers,e("lineErrorButton").checked=d.app.lineErrors,e("lineWrapButton").checked=d.app.lineWrap,S(),N()}function S(){e("defaultSettingsButton").style.display=DeepDiff.diff(d.app,u.app)?"inline":"none"}function N(){e("resetSizeButton").style.display=c&&l.sendSync("isResized")&&!l.sendSync("isMaximized")?"block":"none"}function E(){e("keywordTipsButton").disabled=!e("syntaxButton").checked,e("matchBracketsButton").disabled=!e("syntaxButton").checked,e("keywordTipsButton").parentNode.style.opacity=e("syntaxButton").checked?"1":"0.5",e("matchBracketsButton").parentNode.style.opacity=e("syntaxButton").checked?"1":"0.5"}function I(){e("bigNumWarn").style.display="BigNumber"===e("numericOutput").value?"inline-block":"none"}function C(){d.app.theme=e("themeList").value,d.app.fontSize=e("fontSize").value,d.app.fontWeight=e("fontWeight").value,d.app.dateFormat=e("dateFormat").value,d.app.timeFormat=e("timeFormat").value,d.app.dateDay=e("dateDay").checked,d.app.syntax=e("syntaxButton").checked,d.app.keywordTips=e("keywordTipsButton").checked,d.app.matchBrackets=e("matchBracketsButton").checked,d.app.precision=e("precisionRange").value,d.app.numericOutput=e("numericOutput").value,d.app.contPrevLine=e("contPrevLineButton").checked,d.app.matrixType=e("matrixType").value,d.app.predictable=e("predictableButton").checked,d.app.thouSep=e("thouSepButton").checked,!d.app.currencies&&e("currencyButton").checked?h():e("currencyButton").checked||(localStorage.removeItem("rateDate"),m={}),d.app.currencies=e("currencyButton").checked,d.app.autocomplete=e("autocompleteButton").checked,d.app.closeBrackets=e("closeBracketsButton").checked,d.app.divider=e("dividerButton").checked,d.app.lineNumbers=e("lineNoButton").checked,d.app.lineErrors=e("lineErrorButton").checked,d.app.lineWrap=e("lineWrapButton").checked,a("settings",d),S(),B()}let H;x(),e("openButton").className=w()>0?"action":"noAction",e("actions").addEventListener("click",(a=>{switch(a.target.id){case"clearButton":""!==o.getValue()&&(o.setValue(""),o.focus(),g());break;case"printButton":UIkit.tooltip("#printButton").hide(),""!==o.getValue()&&(e("print-title").innerHTML=appInfo.productName,e("printBox").innerHTML=e("panel").innerHTML,c?(l.send("print"),l.on("printReply",((t,a)=>{a&&P(a),e("printBox").innerHTML=""}))):window.print());break;case"saveButton":""!==o.getValue()&&(e("saveTitle").value="",L("#dialog-save"),e("saveTitle").focus());break;case"openButton":Object.keys(t("saved")||{}).length>0&&L("#dialog-open");break;case"udfuButton":L("#dialog-udfu");break;case"settingsButton":L("#dialog-settings");break;case"helpButton":L("#dialog-help"),e("searchBox").focus();break;case"aboutButton":L("#dialog-about")}a.stopPropagation()})),e("output").addEventListener("click",(t=>{switch(t.target.className){case"answer":navigator.clipboard.writeText(t.target.innerText),P(`Copied '${t.target.innerText}' to clipboard.`);break;case"plotButton":O=t.target.getAttribute("data-func");try{e("plotGrid").checked=d.plot.plotGrid,e("plotCross").checked=d.plot.plotCross,e("plotArea").checked=d.plot.plotArea,W(),L("#dialog-plot")}catch(e){j(e)}break;case"lineError":j(t.target.getAttribute("data-error"),"Error on Line "+t.target.getAttribute("data-line"))}t.stopPropagation()})),e("output").addEventListener("mousedown",(()=>{const e=document.getElementsByClassName("CodeMirror-selected");for(;e[0];)e[0].classList.remove("CodeMirror-selected")})),document.addEventListener("click",(s=>{switch(s.target.id){case"dialog-save-save":{const i=n.local().toFormat("yyyyMMddHHmmssSSS"),r=t("saved")||{},s=o.getValue(),c=e("saveTitle").value.replace(/<|>/g,"").trim()||"No title";r[i]=[c,s],a("saved",r),UIkit.modal("#dialog-save").hide(),e("openButton").className="action",x(),P("Saved");break}case"dialog-open-deleteAll":V("All saved calculations will be deleted.",(()=>{localStorage.removeItem("saved"),T(),UIkit.modal("#dialog-open").hide(),P("Deleted all saved calculations")}));break;case"dialog-udfu-save-f":k(i.getValue().trim());break;case"dialog-udfu-save-u":v(r.getValue().trim());break;case"defaultSettingsButton":V("All settings will revert back to defaults.",(()=>{d.app=u.app,a("settings",d),B(),e("currencyButton").checked||h(),M()}));break;case"dialog-settings-reset":V("All user settings and data will be lost.",(()=>{c?l.send("resetApp"):(localStorage.clear(),location.reload())}));break;case"resetSizeButton":c&&l.send("resetSize");break;case"syntaxButton":E();break;case"bigNumWarn":j('Using the BigNumber may break function plotting and is not compatible with some math functions. \n        It may also cause unexpected behavior and affect overall performance.<br><br>\n        <a target="_blank" href="https://mathjs.org/docs/datatypes/bignumbers.html">Read more on BigNumbers</a>',"Caution: BigNumber Limitations");break;case"currencyButton":e("currencyUpdate").style.visibility=e("currencyButton").checked?"visible":"hidden";break;case"plotGrid":d.plot.plotGrid=e("plotGrid").checked,a("settings",d),W();break;case"plotCross":d.plot.plotCross=e("plotCross").checked,a("settings",d),W();break;case"plotArea":d.plot.plotArea=e("plotArea").checked,a("settings",d),W();break;case"restartButton":l.send("updateApp");break;case"demoButton":o.setValue(_),g(),UIkit.modal("#dialog-help").hide()}})),e("dialog-open").addEventListener("click",(e=>{let n;const i=t("saved");"load"===e.target.parentNode.getAttribute("data-action")&&(n=e.target.parentNode.parentNode.id,o.setValue(i[n][1]),g(),UIkit.modal("#dialog-open").hide()),"delete"===e.target.getAttribute("data-action")&&(n=e.target.parentNode.id,V('Calculation "'+i[n][0]+'" will be deleted.',(()=>{delete i[n],a("saved",i),T()})))})),UIkit.util.on("#dialog-open","beforeshow",T),UIkit.util.on("#setswitch","beforeshow",(e=>{e.stopPropagation()})),UIkit.util.on("#dialog-settings","beforeshow",M),UIkit.util.on("#dialog-settings","hidden",(()=>{o.focus()})),e("numericOutput").addEventListener("change",I),e("precisionRange").addEventListener("input",(()=>{e("precision-label").innerHTML=e("precisionRange").value})),document.querySelectorAll(".settingItem").forEach((e=>{e.addEventListener("change",C)})),e("searchBox").addEventListener("input",(()=>{const t=e("searchBox").value.trim();if(t)try{const a=JSON.parse(JSON.stringify(math.help(t).toJSON()));e("searchResults").innerHTML=`\n        <div>Name:</div><div>${a.name}</div>\n        <div>Description:</div><div>${a.description}</div>\n        <div>Category:</div><div>${a.category}</div>\n        <div>Syntax:</div><div>${String(a.syntax).split(",").join(", ")}</div>\n        <div>Examples:</div><div>${String(a.examples).split(",").join(", ")}</div>\n        <div>Also see:</div><div>${String(a.seealso).split(",").join(", ")}</div>\n        `}catch(a){e("searchResults").innerHTML=`No results for "${t}"`}else e("searchResults").innerHTML="Start typing above to search..."}));let U=!1;const A=e("panel"),F=e("divider");let O,D;e("divider").addEventListener("dblclick",(function(){d.inputWidth=u.inputWidth,a("settings",d),B()})),e("divider").addEventListener("mousedown",(e=>{U=e.target===F})),e("panel").addEventListener("mouseup",(()=>{U=!1})),e("panel").addEventListener("mousemove",(t=>{const n=d.app.lineNumbers?12:27,o=(t.clientX-A.offsetLeft-n)/A.clientWidth*100,i=o<0?0:o>100?100:o;U&&(e("input").style.width=i+"%",d.inputWidth=i,a("settings",d),clearTimeout(H),H=setTimeout(g,10))}));const $=window.functionPlot;function W(){e("plotTitle").innerHTML=O;const t=O.split("=")[1];let a=2*math.abs(math.evaluate(t,{x:0}));a!==1/0&&0!==a||(a=10);const n=D?D.meta.xScale.domain():[-a,a],o=D?D.meta.yScale.domain():[-a,a];D=$({target:"#plot",height:e("plot").clientHeight,width:e("plot").clientWidth,xAxis:{domain:n},yAxis:{domain:o},tip:{xLine:d.plot.plotCross,yLine:d.plot.plotCross},grid:d.plot.plotGrid,data:[{fn:t,graphType:"polyline",closed:d.plot.plotArea}],plugins:[$.plugins.zoomBox()]})}let z;function V(t,a){e("confirmMsg").innerHTML=t,L("#dialog-confirm");const n=t=>{a(),t.stopPropagation(),UIkit.modal("#dialog-confirm").hide(),e("confirm-yes").removeEventListener("click",n)};e("confirm-yes").addEventListener("click",n),UIkit.util.on("#dialog-confirm","hidden",(()=>{e("confirm-yes").removeEventListener("click",n)}))}function j(t,a){UIkit.util.on("#dialog-error","beforeshow",(()=>{e("errTitle").innerHTML=a||"Error",e("errMsg").innerHTML=t})),L("#dialog-error")}function P(e,t){UIkit.notification({message:e,status:t||"primary",pos:"bottom-center",timeout:3e3})}UIkit.util.on("#dialog-plot","shown",W),UIkit.util.on("#dialog-plot","hide",(()=>{D=!1})),window.addEventListener("resize",(()=>{D&&e("dialog-plot").classList.contains("uk-open")&&W(),clearTimeout(z),z=setTimeout(g,10),N()}));let R=!1,G=!1;const J=document.getElementsByClassName("CodeMirror-scroll")[0],q=e("output");J.addEventListener("scroll",(()=>{R||(G=!0,q.scrollTop=J.scrollTop),R=!1})),q.addEventListener("scroll",(()=>{G||(R=!0,J.scrollTop=q.scrollTop),G=!1,e("scrollTop").style.display=e("output").scrollTop>50?"block":"none"})),e("scrollTop").addEventListener("click",(()=>{e("output").scrollTop=0}));Object.entries({clearButton:["command+d","ctrl+d"],printButton:["command+p","ctrl+p"],saveButton:["command+s","ctrl+s"],openButton:["command+o","ctrl+o"]}).forEach((([t,a])=>{Mousetrap.bindGlobal(a,(a=>{a.preventDefault(),0===document.getElementsByClassName("uk-open").length&&e(t).click()}))})),c&&(l.send("checkUpdate"),l.on("notifyUpdate",(t=>{P('Updating Numara to latest version... <a class="updateLink" onclick="$(`aboutButton`).click()">View update status</a>'),e("notificationDot").style.display="block"})),l.on("updateStatus",((t,a)=>{"ready"===a?(e("dialog-about-updateStatus").innerHTML="Restart Numara to finish updating.",e("restartButton").style.display="inline-block",e("dialog-about").classList.contains("uk-open")||P('Restart Numara to finish updating. <a class="updateLink" onclick="$(`restartButton`).click()">Restart Now</a>')):e("dialog-about-updateStatus").innerHTML=a})));const _="1+2\n\n    # In addition to mathjs functions, you can do:\n    ans // Get last answer\n    total // Total up to this point\n    avg // Average up to this point\n    line4 // Get answer from a line#\n    subtotal // Subtotal last block\n\n    # Percentages:\n    10% of 20\n    40 + 30%\n\n    # Dates\n    today\n    now\n    today - 3 weeks\n    now + 36 hours - 2 days\n\n    # Currency conversion\n    1 usd to try\n    20 cad to usd\n\n    # Plot functions\n    f(x) = sin(x)\n    f(x) = 2x^2 + 3x - 5\n    ".replace(/^ +/gm,"");window.addEventListener("load",(()=>{setTimeout((()=>{document.getElementsByClassName("CodeMirror-code")[0].lastChild.scrollIntoView()}),250),setTimeout((()=>{o.focus()}),500)}))})();