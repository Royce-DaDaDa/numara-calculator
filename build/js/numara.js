/**
 * @copyright 2022 Timur Atalay
 * @homepage https://github.com/bornova/numara-calculator
 * @license MIT - https://github.com/bornova/numara-calculator/blob/master/LICENSE
 */

appInfo = {
    productName: 'Numara',
    description:'Numara Calculator',
    version: '3.10.0',
    author: 'Timur Atalay',
    homepage: 'https://github.com/bornova/numara-calculator',
    licence: 'MIT',
    website: 'https://numara.io'
};
(()=>{const e=(e,t)=>t?document.querySelectorAll(e):document.querySelector(e),t=e=>JSON.parse(localStorage.getItem(e)),n=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},o=luxon.DateTime;lucide.createIcons();const a=CodeMirror.fromTextArea(e("#inputArea"),{theme:"numara",coverGutterNextToScrollbar:!0,inputStyle:"textarea",viewportMargin:1/0});a.setValue(t("input")||""),a.execCommand("goDocEnd"),e("#udfInput").setAttribute("placeholder",'// Define new functions and variables:\n    myvalue: 42,\n    hello: (name) => {\n    \treturn "hello, " + name + "!"\n    }'.replace(/^ +/gm,""));const i=CodeMirror.fromTextArea(e("#udfInput"),{mode:"javascript",autoCloseBrackets:!0,smartIndent:!1});e("#uduInput").setAttribute("placeholder",'// Define new units:\n    foo: {\n    \tprefixes: "long",\n    \tbaseName: "essence-of-foo"\n    },\n    bar: "40 foo",\n    baz: {\n    \tdefinition: "1 bar/hour",\n    \tprefixes: "long"\n    }'.replace(/^ +/gm,""));const r=CodeMirror.fromTextArea(e("#uduInput"),{mode:"javascript",autoCloseBrackets:!0,smartIndent:!1}),s=navigator.userAgent.toLowerCase().includes("mac"),c=navigator.userAgent.toLowerCase().includes("electron"),l=c?require("electron").ipcRenderer:null;function p(){l.send(l.sendSync("isMaximized")?"unmaximize":"maximize")}let d;document.title=appInfo.description,e("#dialog-about-title").innerHTML=appInfo.description,e("#dialog-about-copyright").innerHTML=`Copyright ©️ ${o.local().year} ${appInfo.author}`,e("#dialog-about-appVersion").innerHTML=c?"Version "+appInfo.version:`Version ${appInfo.version}\n      <div class="versionCtnr">\n        <div>\n          <a href="https://github.com/bornova/numara-calculator/releases" target="_blank">Download desktop version</a>\n        </div>\n      </div>`,e("#gitLink").setAttribute("href",appInfo.homepage),e("#webLink").setAttribute("href",appInfo.website),e("#licenseLink").setAttribute("href",appInfo.homepage+"/blob/master/LICENSE"),c?(l.on("themeUpdate",w),l.on("fullscreen",((e,t)=>{t&&l.send("maximize")}))):"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").catch((()=>{console.log("Service worker registration failed")})),c&&!s?(e("#header-mac").remove(),e("#header-win").style.display="block",e("#header-win-title").innerHTML=appInfo.productName,e("#max").style.display=l.sendSync("isMaximized")?"none":"block",e("#unmax").style.display=l.sendSync("isMaximized")?"block":"none",e("#winButtons").addEventListener("click",(e=>{switch(e.target.id){case"min":l.send("minimize");break;case"max":l.send("maximize");break;case"unmax":l.send("unmaximize");break;case"close":l.send("close")}e.stopPropagation()})),l.on("isMax",((t,n)=>{e("#unmax").style.display=n?"block":"none",e("#max").style.display=n?"none":"block"})),e("#header-win").addEventListener("dblclick",p)):(e("#header-win").remove(),e("#header-mac").style.display="block",e("#header-mac-title").innerHTML=appInfo.productName,c&&e("#header-mac").addEventListener("dblclick",p));const u={app:{autocomplete:!0,closeBrackets:!0,contPrevLine:!0,currencies:!0,dateDay:!1,dateFormat:"M/d/yyyy",divider:!0,expNotation:!1,expLower:"-12",expUpper:"12",fontSize:"1.1rem",fontWeight:"400",keywordTips:!0,lineErrors:!0,lineNumbers:!0,lineWrap:!0,matchBrackets:!0,matrixType:"Matrix",numericOutput:"number",precision:"4",predictable:!1,syntax:!0,theme:"system",thouSep:!0,timeFormat:"h:mm a"},inputWidth:60,plot:{plotArea:!1,plotCross:!1,plotGrid:!1}};d=t("settings"),d?DeepDiff.observableDiff(d,u,(e=>{"E"!==e.kind&&(DeepDiff.applyChange(d,u,e),n("settings",d))})):(d=u,n("settings",u)),math.createUnit("USD",{aliases:["usd"]});let m,h={};function g(){navigator.onLine?(e("#lastUpdated").innerHTML='<div uk-spinner="ratio: 0.3"></div>',fetch("https://www.floatrates.com/widget/1030/cfc5515dfc13ada8d7b0e50b8143d55f/usd.json").then((e=>e.json())).then((o=>{h=o;const a=["cup"];Object.keys(o).forEach((e=>{math.createUnit(o[e].code,{definition:math.unit(o[e].inverseRate+"USD"),aliases:[a.includes(o[e].code.toLowerCase())?"":o[e].code.toLowerCase()]},{override:!0}),n("rateDate",o[e].date)})),w(),e("#lastUpdated").innerHTML=t("rateDate")})).catch((t=>{e("#lastUpdated").innerHTML="n/a",q("Failed to get exchange rates ("+t+")","warning")}))):(e("#lastUpdated").innerHTML="No internet connection.",q("No internet connection. Could not update exchange rates.","warning"))}function f(){const t=[],i=[],r=[];let s="";function c(e){const n=math.evaluate(t.length>0?"("+math.mean(t)+")":0),a=math.evaluate(i.length>0?"("+i.join("+")+")":0),s=math.evaluate(r.length>0?"("+r.join("+")+")":0);m.now=o.local().toFormat((d.app.dateDay?"ccc, ":"")+d.app.dateFormat+" "+d.app.timeFormat),m.today=o.local().toFormat((d.app.dateDay?"ccc, ":"")+d.app.dateFormat);const c=(e=e.replace(/\bans\b/g,m.ans).replace(/\bnow\b/g,m.now).replace(/\btoday\b/g,m.today).replace(/\bavg\b/g,n).replace(/\btotal\b/g,a).replace(/\bsubtotal\b/g,s)).match(/\bline\d+\b/g);c&&c.forEach((t=>{e=m[t]?e.replace(t,m[t]):t}));if(e.match(/'millisecond|second|minute|hour|day|week|month|quarter|year|decade|century|centuries|millennium|millennia'/g)){const t=e.split(/[+-]/)[0],n=t.replace(/[A-Za-z]+,/,"").trim(),a=e.replace(t,"").trim(),i=d.app.dateFormat,r=d.app.dateFormat+" "+d.app.timeFormat,s=o.fromFormat(n,i),c=o.fromFormat(n,r),l=s.isValid?s:c.isValid?c:null,p=String(math.evaluate(a+" to hours",m)),u=Number(p.split(" ")[0]);if(!l)return"Invalid Date";{const t=l.toFormat(d.app.dateFormat+"hh:mm:ss:SSS").endsWith("12:00:00:000");e=`"${l.plus({hours:u}).toFormat((d.app.dateDay?"ccc, ":"")+(t?i:r))}"`}}return e=e.match(/[\w.]*%[ ]*of[ ]*/g)?e.replace(/%[ ]*of[ ]*/g,"/100*"):e,math.evaluate(e,m)}N&&a.refresh(),m={},a.eachLine((e=>{const n=a.getLineNumber(e),o=n+1;a.removeLineClass(n,"gutter","lineNoError");let l="",p=e.text.trim().split("//")[0].split("#")[0];if(p)try{p=o>1&&p.charAt(0).match(/[+\-*/]/)&&a.getLine(o-2).length>0&&d.app.contPrevLine?m.ans+p:p;try{l=math.evaluate(p,m)}catch(e){if(p.match(/:/))try{math.evaluate(p.split(":")[0])}catch(e){p=p.substring(p.indexOf(":")+1)}for(;p.match(/\([^)]+\)/);){let e=p.substring(p.lastIndexOf("(")+1),t=p.substring(p.lastIndexOf("("));if(e=e.substring(0,e.indexOf(")")),t=t.substring(0,t.indexOf(")")+1),0===t.length)break;try{p=p.replace(t,c(e))}catch(e){break}}l=c(p)}if(void 0!==l){if(m.ans=l,m["line"+o]=l,isNaN(l)||(t.push(l),i.push(l),r.push(l)),l=y(math.format(l,{notation:d.app.expNotation?"exponential":"auto",lowerExp:d.app.expLower,upperExp:d.app.expUpper})),l.match(/\w\(x\)/)){const e=/\w\(x\)$/.test(l)?p.trim():l.trim();l=`<a class="plotButton" data-func="${e}">Plot</a>`,m.ans=e,m["line"+o]=e}}else r.length=0,l=""}catch(e){const t=String(e).replace(/'|"/g,"`");l=d.app.lineErrors?`<a class="lineError" data-line="${o}" data-error="${t}">Error</a>`:"",d.app.lineErrors&&a.addLineClass(n,"gutter","lineNoError")}else r.length=0;s+=`\n        <div line-no=${n} style="height:${e.height}px">\n          <span class="${l&&!l.startsWith("<a")?"answer":""}" >${l}</span>\n        </div>`})),e("#output").innerHTML=s,e("#clearButton").className=""===a.getValue()?"noAction":"action",e("#printButton").className=""===a.getValue()?"noAction":"action",e("#copyButton").className=""===a.getValue()?"noAction":"action",e("#saveButton").className=""===a.getValue()?"noAction":"action",n("input",a.getValue())}function y(e){const t=(e=String(e)).trim().split(" ")[0],n=e.replace(t,""),o={maximumFractionDigits:d.app.precision};return t.includes("e")||isNaN(t)?t.match(/e-?\d+/)?parseFloat(Number(t.split("e")[0]).toFixed(d.app.precision))+"e"+e.split("e")[1]+n:function(e){let t=e.length;return'"'===e.charAt(0)&&(e=e.substring(1,t--)),'"'===e.charAt(--t)&&(e=e.substring(0,t)),e}(e):d.app.thouSep?Number(t).toLocaleString(void 0,o)+n:parseFloat(Number(t).toFixed(d.app.precision))+n}const v=[],b=[];function k(t){try{new Function(`'use strict'; math.import({${t}}, {override: true})`)(),f(),n("udf",t);const e=new Function(`'use strict'; return {${t}}`)();for(const t in e)v.push(t);UIkit.modal("#dialog-udfu").hide()}catch(t){e("#udfSyntaxError").innerHTML=t}}function x(t){try{new Function(`'use strict'; math.createUnit({${t}}, {override: true})`)(),f(),n("udu",t);const e=new Function(`'use strict'; return {${t}}`)();for(const t in e)b.push(t);UIkit.modal("#dialog-udfu").hide()}catch(t){e("#uduSyntaxError").innerHTML=t}}UIkit.util.on("#dialog-udfu","beforeshow",(()=>{e("#udfSyntaxError").innerHTML="",e("#uduSyntaxError").innerHTML="";const n=t("udf").trim(),o=t("udu").trim();i.setValue(n),r.setValue(o)})),UIkit.util.on("#dialog-udfu","shown",(()=>{i.refresh(),r.refresh()})),t("udf")||n("udf",""),t("udu")||n("udu",""),k(t("udf")),x(t("udu")),CodeMirror.defineMode("numara",(()=>({token:e=>{if(e.match(/\/\/.*/)||e.match(/#.*/))return"comment";if(e.match(/\d/))return"number";if(e.match(/(?:\+|-|\*|\/|,|;|\.|:|@|~|=|>|<|&|\||_|`|'|\^|\?|!|%)/))return"operator";e.eatWhile(/\w/);const t=e.current();if(d.app.currencies&&(t.toLowerCase()in h||"usd"===t.toLowerCase()))return"currency";try{if(math.unit(t).units.length>0)return"unit"}catch(e){}if(v.includes(t))return"udf";if(b.includes(t))return"udu";if("function"==typeof math[t]&&Object.getOwnPropertyNames(math[t]).includes("signatures"))return"function";if(t.match(/\b(?:ans|total|subtotal|avg|today|now)\b/))return"scope";if(t.match(/\b(?:line\d+)\b/))return"lineNo";try{math.evaluate(t)}catch(e){return"variable"}return e.next(),"space"}}))),CodeMirror.defineMode("plain",(()=>({token:e=>(e.next(),"text")})));const L=["ans","now","today","total","subtotal","avg"];function w(){d=t("settings"),e("#style").setAttribute("href","system"===d.app.theme?c&&l.sendSync("isDark")?"css/dark.css":"css/light.css":"light"===d.app.theme?"css/light.css":"css/dark.css"),c&&l.send("setTheme",d.app.theme);const n=e(".panelFont, .CodeMirror",!0);for(const e of n)e.style.fontSize=d.app.fontSize,e.style.fontWeight=d.app.fontWeight;e("#input").style.width=(d.app.divider?d.inputWidth:u.inputWidth)+"%",e("#divider").style.display=d.app.divider?"block":"none",e("#output").style.textAlign=d.app.divider?"left":"right",a.setOption("mode",d.app.syntax?"numara":"plain"),a.setOption("lineNumbers",d.app.lineNumbers),a.setOption("lineWrapping",d.app.lineWrap),a.setOption("autoCloseBrackets",d.app.closeBrackets),a.setOption("matchBrackets",!(!d.app.syntax||!d.app.matchBrackets)&&{maxScanLines:1});const o="system"===d.app.theme?c&&l.sendSync("isDark")?"material-darker":"default":"light"===d.app.theme?"default":"material-darker";i.setOption("theme",o),r.setOption("theme",o),math.config({matrix:d.app.matrixType,number:d.app.numericOutput,predictable:d.app.predictable}),setTimeout(f,10)}function T(e){UIkit.modal(e,{bgClose:!1,stack:!0}).show()}Object.getOwnPropertyNames(math).forEach((e=>{"function"==typeof math[e]&&Object.getOwnPropertyNames(math[e]).includes("signatures")&&L.push(e)})),CodeMirror.registerHelper("hint","numaraHints",(e=>{const t=e.getCursor(),n=e.getLine(t.line);let o=t.ch,a=o;for(;a<n.length&&/[\w$]/.test(n.charAt(a));)++a;for(;o&&/[\w$]/.test(n.charAt(o-1));)--o;const i=o!==a&&n.slice(o,a),r=new RegExp("^"+i,"i");return{list:(i?L.filter((e=>e.match(r))):[]).sort(),from:CodeMirror.Pos(t.line,o),to:CodeMirror.Pos(t.line,a)}})),CodeMirror.commands.autocomplete=e=>{CodeMirror.showHint(e,CodeMirror.hint.numaraHints,{completeSingle:!1})},a.on("changes",f),a.on("inputRead",(e=>{d.app.autocomplete&&CodeMirror.commands.autocomplete(e)})),a.on("update",(()=>{const t=e(".cm-function",!0);if(t.length>0&&d.app.keywordTips)for(const e of t)try{const t=JSON.stringify(math.help(e.innerText).toJSON()),n=JSON.parse(t);UIkit.tooltip(e,{title:n.description,pos:"top-left"})}catch(t){UIkit.tooltip(e,{title:"Description not available.",pos:"top-left"})}const n=e(".cm-udf",!0);if(n.length>0&&d.app.keywordTips)for(const e of n)UIkit.tooltip(e,{title:"User defined function.",pos:"top-left"});const o=e(".cm-udu",!0);if(o.length>0&&d.app.keywordTips)for(const e of o)UIkit.tooltip(e,{title:"User defined unit.",pos:"top-left"});const a=e(".cm-currency",!0);if(a.length>0&&d.app.keywordTips)for(const e of a)try{const t=e.innerText.toLowerCase(),n="usd"===t?"U.S. Dollar":h[t].name;UIkit.tooltip(e,{title:n,pos:"top-left"})}catch(t){UIkit.tooltip(e,{title:"Description not available.",pos:"top-left"})}const i=e(".cm-unit",!0);if(i.length>0&&d.app.keywordTips)for(const e of i)UIkit.tooltip(e,{title:`Unit '${e.innerText}'`,pos:"top-left"});const r=e(".cm-lineNo",!0);if(r.length>0&&d.app.keywordTips)for(const e of r){let t;try{t=y(math.evaluate(e.innerText,m))}catch(e){t="Undefined"}UIkit.tooltip(e,{title:t,pos:"top-left"})}})),w(),d.app.currencies&&g(),UIkit.mixin({data:{delay:500,offset:5}},"tooltip"),UIkit.util.on(".modal","hidden",(()=>{a.focus()})),UIkit.util.on(".uk-switcher","show",(()=>{a.getInputField().blur()}));const B=()=>Object.keys(t("saved")||{}).length;function M(){UIkit.tooltip("#openButton",{title:"Open ("+B()+")"})}M(),e("#openButton").className=B()>0?"action":"noAction",e("#actions").addEventListener("click",(n=>{switch(n.target.id){case"clearButton":""!==a.getValue()&&(a.setValue(""),a.focus(),f());break;case"printButton":UIkit.tooltip("#printButton").hide(),""!==a.getValue()&&(e("#print-title").innerHTML=appInfo.productName,e("#printBox").innerHTML=e("#panel").innerHTML,c?(l.send("print"),l.on("printReply",((t,n)=>{n&&q(n),e("#printBox").innerHTML=""}))):window.print());break;case"copyButton":te();break;case"saveButton":""!==a.getValue()&&(e("#saveTitle").value="",T("#dialog-save"),e("#saveTitle").focus());break;case"openButton":Object.keys(t("saved")||{}).length>0&&T("#dialog-open");break;case"udfuButton":T("#dialog-udfu");break;case"settingsButton":T("#dialog-settings");break;case"helpButton":T("#dialog-help"),e("#searchBox").focus();break;case"aboutButton":T("#dialog-about")}n.stopPropagation()})),e("#output").addEventListener("click",(t=>{switch(t.target.className){case"answer":navigator.clipboard.writeText(t.target.innerText),q(`Copied '${t.target.innerText}' to clipboard.`);break;case"plotButton":W=t.target.getAttribute("data-func");try{e("#plotGrid").checked=d.plot.plotGrid,e("#plotCross").checked=d.plot.plotCross,e("#plotArea").checked=d.plot.plotArea,R(),T("#dialog-plot")}catch(e){G(e)}break;case"lineError":G(t.target.getAttribute("data-error"),"Error on Line "+t.target.getAttribute("data-line"))}t.stopPropagation()})),e("#output").addEventListener("mousedown",(()=>{const e=document.getElementsByClassName("CodeMirror-selected");for(;e[0];)e[0].classList.remove("CodeMirror-selected")}));let S,N=!0;function E(){const n=t("saved")||{},a=Object.entries(n);e("#dialog-open-body").innerHTML="",a.length>0?(e("#dialog-open-deleteAll").disabled=!1,a.forEach((([t,n])=>{e("#dialog-open-body").innerHTML+=`\n          <div class="dialog-open-wrapper" id="${t}">\n            <div data-action="load">\n              <div class="dialog-open-title">${n[0]}</div>\n              <div class="dialog-open-date">${o.fromFormat(t,"yyyyMMddHHmmssSSS").toFormat("ff")}</div>\n            </div>\n            <span class="dialog-open-delete" data-action="delete"><i icon-name="x-circle"></i></span>\n          </div>`})),lucide.createIcons()):(e("#dialog-open-deleteAll").disabled=!0,e("#dialog-open-body").innerHTML="No saved calculations.",e("#openButton").className="noAction"),M()}function U(){const n=["M/d/yyyy","d/M/yyyy","MMM d, yyyy"],a=["h:mm a","H:mm"],i=["Matrix","Array"],r=["number","BigNumber","Fraction"];e("#themeList").value=d.app.theme,e("#fontSize").value=d.app.fontSize,e("#fontWeight").value=d.app.fontWeight,e("#dateFormat").innerHTML="";for(const t of n)e("#dateFormat").innerHTML+=`<option value="${t}">${o.local().toFormat(t)}</option>`;e("#dateFormat").value=d.app.dateFormat,e("#timeFormat").innerHTML="";for(const t of a)e("#timeFormat").innerHTML+=`<option value="${t}">${o.local().toFormat(t)}</option>`;e("#timeFormat").value=d.app.timeFormat,e("#dateDay").checked=d.app.dateDay,e("#syntaxButton").checked=d.app.syntax,A(),e("#keywordTipsButton").checked=d.app.keywordTips,e("#matchBracketsButton").checked=d.app.matchBrackets,e("#precisionRange").value=d.app.precision,e("#precision-label").innerHTML=d.app.precision,e("#expLowerRange").value=d.app.expLower,e("#expLower-label").innerHTML=d.app.expLower,e("#expUpperRange").value=d.app.expUpper,e("#expUpper-label").innerHTML=d.app.expUpper,e("#expNotationButton").checked=d.app.expNotation,e("#numericOutput").innerHTML="";for(const t of r)e("#numericOutput").innerHTML+=`<option value="${t}">${t.charAt(0).toUpperCase()+t.slice(1)}</option>`;e("#numericOutput").value=d.app.numericOutput,"BigNumber"===d.app.numericOutput&&H(),e("#contPrevLineButton").checked=d.app.contPrevLine,e("#matrixType").innerHTML="";for(const t of i)e("#matrixType").innerHTML+=`<option value="${t}">${t}</option>`;e("#matrixType").value=d.app.matrixType,e("#predictableButton").checked=d.app.predictable,e("#thouSepButton").checked=d.app.thouSep,e("#currencyButton").checked=d.app.currencies,e("#lastUpdated").innerHTML=d.app.currencies?t("rateDate"):"",e("#currencyUpdate").style.display=d.app.currencies?"block":"none",e("#autocompleteButton").checked=d.app.autocomplete,e("#closeBracketsButton").checked=d.app.closeBrackets,e("#dividerButton").checked=d.app.divider,e("#lineNoButton").checked=d.app.lineNumbers,e("#lineErrorButton").checked=d.app.lineErrors,e("#lineWrapButton").checked=d.app.lineWrap,I(),C()}function I(){e("#defaultSettingsButton").style.display=DeepDiff.diff(d.app,u.app)?"inline":"none"}function C(){e("#resetSizeButton").style.display=c&&l.sendSync("isResized")&&!l.sendSync("isMaximized")?"block":"none"}function A(){e("#keywordTipsButton").disabled=!e("#syntaxButton").checked,e("#matchBracketsButton").disabled=!e("#syntaxButton").checked,e("#keywordTipsButton").parentNode.style.opacity=e("#syntaxButton").checked?"1":"0.5",e("#matchBracketsButton").parentNode.style.opacity=e("#syntaxButton").checked?"1":"0.5"}function H(){e("#bigNumWarn").style.display="BigNumber"===e("#numericOutput").value?"inline-block":"none"}function $(){d.app.theme=e("#themeList").value,d.app.fontSize=e("#fontSize").value,d.app.fontWeight=e("#fontWeight").value,d.app.dateFormat=e("#dateFormat").value,d.app.timeFormat=e("#timeFormat").value,d.app.dateDay=e("#dateDay").checked,d.app.syntax=e("#syntaxButton").checked,d.app.keywordTips=e("#keywordTipsButton").checked,d.app.matchBrackets=e("#matchBracketsButton").checked,d.app.precision=e("#precisionRange").value,d.app.expLower=e("#expLowerRange").value,d.app.expUpper=e("#expUpperRange").value,d.app.expNotation=e("#expNotationButton").checked,d.app.numericOutput=e("#numericOutput").value,d.app.contPrevLine=e("#contPrevLineButton").checked,d.app.matrixType=e("#matrixType").value,d.app.predictable=e("#predictableButton").checked,d.app.thouSep=e("#thouSepButton").checked,!d.app.currencies&&e("#currencyButton").checked?g():e("#currencyButton").checked||(localStorage.removeItem("rateDate"),h={}),d.app.currencies=e("#currencyButton").checked,d.app.autocomplete=e("#autocompleteButton").checked,d.app.closeBrackets=e("#closeBracketsButton").checked,d.app.divider=e("#dividerButton").checked,d.app.lineNumbers=e("#lineNoButton").checked,d.app.lineErrors=e("#lineErrorButton").checked,d.app.lineWrap=e("#lineWrapButton").checked,n("settings",d),I(),w()}document.addEventListener("keydown",(e=>{N=!e.repeat})),document.addEventListener("keyup",(()=>{N=!0})),document.addEventListener("click",(s=>{switch(s.target.id){case"dialog-save-save":{const i=o.local().toFormat("yyyyMMddHHmmssSSS"),r=t("saved")||{},s=a.getValue(),c=e("#saveTitle").value.replace(/<|>/g,"").trim()||"No title";r[i]=[c,s],n("saved",r),UIkit.modal("#dialog-save").hide(),e("#openButton").className="action",M(),q(`Saved as '${c}' <a class="notificationLink" onclick="document.querySelector('#openButton').click()">View saved calculations</a>`);break}case"dialog-open-deleteAll":j("All saved calculations will be deleted.",(()=>{localStorage.removeItem("saved"),E(),UIkit.modal("#dialog-open").hide(),q("Deleted all saved calculations")}));break;case"dialog-udfu-save-f":k(i.getValue().trim());break;case"dialog-udfu-save-u":x(r.getValue().trim());break;case"defaultSettingsButton":j("All settings will revert back to defaults.",(()=>{d.app=u.app,n("settings",d),w(),e("#currencyButton").checked||g(),U()}));break;case"dialog-settings-reset":j("All user settings and data will be lost.",(()=>{c?l.send("resetApp"):(localStorage.clear(),location.reload())}));break;case"resetSizeButton":c&&l.send("resetSize");break;case"syntaxButton":A();break;case"bigNumWarn":G('Using the BigNumber may break function plotting and is not compatible with some math functions. \n          It may also cause unexpected behavior and affect overall performance.<br><br>\n          <a target="_blank" href="https://mathjs.org/docs/datatypes/bignumbers.html">Read more on BigNumbers</a>',"Caution: BigNumber Limitations");break;case"currencyButton":e("#currencyUpdate").style.visibility=e("#currencyButton").checked?"visible":"hidden";break;case"plotGrid":d.plot.plotGrid=e("#plotGrid").checked,n("settings",d),R();break;case"plotCross":d.plot.plotCross=e("#plotCross").checked,n("settings",d),R();break;case"plotArea":d.plot.plotArea=e("#plotArea").checked,n("settings",d),R();break;case"restartButton":l.send("updateApp");break;case"demoButton":a.setValue(ne),f(),UIkit.modal("#dialog-help").hide()}})),e("#dialog-open").addEventListener("click",(e=>{let o;const i=t("saved");"load"===e.target.parentNode.getAttribute("data-action")&&(o=e.target.parentNode.parentNode.id,a.setValue(i[o][1]),f(),UIkit.modal("#dialog-open").hide()),"delete"===e.target.getAttribute("data-action")&&(o=e.target.parentNode.id,j('Calculation "'+i[o][0]+'" will be deleted.',(()=>{delete i[o],n("saved",i),E()})))})),UIkit.util.on("#dialog-open","beforeshow",E),UIkit.util.on("#setswitch","beforeshow",(e=>{e.stopPropagation()})),UIkit.util.on("#dialog-settings","beforeshow",U),UIkit.util.on("#dialog-settings","hidden",(()=>{a.focus()})),e("#numericOutput").addEventListener("change",H),e("#precisionRange").addEventListener("input",(()=>{e("#precision-label").innerHTML=e("#precisionRange").value})),e("#expLowerRange").addEventListener("input",(()=>{e("#expLower-label").innerHTML=e("#expLowerRange").value})),e("#expUpperRange").addEventListener("input",(()=>{e("#expUpper-label").innerHTML=e("#expUpperRange").value})),document.querySelectorAll(".settingItem").forEach((e=>{e.addEventListener("change",$)})),e("#searchBox").addEventListener("input",(()=>{const t=e("#searchBox").value.trim();if(t)try{const n=JSON.parse(JSON.stringify(math.help(t).toJSON()));e("#searchResults").innerHTML=`\n          <div>Name:</div><div>${n.name}</div>\n          <div>Description:</div><div>${n.description}</div>\n          <div>Category:</div><div>${n.category}</div>\n          <div>Syntax:</div><div>${String(n.syntax).split(",").join(", ")}</div>\n          <div>Examples:</div><div>${String(n.examples).split(",").join(", ")}</div>\n          <div>Also see:</div><div>${String(n.seealso).split(",").join(", ")}</div>`}catch(n){e("#searchResults").innerHTML=`No results for "${t}"`}else e("#searchResults").innerHTML="Start typing above to search..."}));let F=!1;const O=e("#panel"),D=e("#divider");let W,V;e("#divider").addEventListener("dblclick",(function(){d.inputWidth=u.inputWidth,n("settings",d),w()})),e("#divider").addEventListener("mousedown",(e=>{F=e.target===D})),e("#panel").addEventListener("mouseup",(()=>{F=!1})),e("#panel").addEventListener("mousemove",(t=>{if(F){const o=d.app.lineNumbers?12:27,a=(t.clientX-O.offsetLeft-o)/O.clientWidth*100,i=a<0?0:a>100?100:a;e("#input").style.width=i+"%",d.inputWidth=i,n("settings",d),clearTimeout(S),S=setTimeout(f,10)}}));const z=window.functionPlot;function R(){e("#plotTitle").innerHTML=W;const t=W.split("=")[1];let n=2*math.abs(math.evaluate(t,{x:0}));n!==1/0&&0!==n||(n=10);const o=V?V.meta.xScale.domain():[-n,n],a=V?V.meta.yScale.domain():[-n,n];V=z({target:"#plot",height:e("#plot").clientHeight,width:e("#plot").clientWidth,xAxis:{domain:o},yAxis:{domain:a},tip:{xLine:d.plot.plotCross,yLine:d.plot.plotCross},grid:d.plot.plotGrid,data:[{fn:t,graphType:"polyline",closed:d.plot.plotArea}],plugins:[z.plugins.zoomBox()]})}let P;function j(t,n){e("#confirmMsg").innerHTML=t,T("#dialog-confirm");const o=t=>{n(),t.stopPropagation(),UIkit.modal("#dialog-confirm").hide(),e("#confirm-yes").removeEventListener("click",o)};e("#confirm-yes").addEventListener("click",o),UIkit.util.on("#dialog-confirm","hidden",(()=>{e("#confirm-yes").removeEventListener("click",o)}))}function G(t,n){UIkit.util.on("#dialog-error","beforeshow",(()=>{e("#errTitle").innerHTML=n||"Error",e("#errMsg").innerHTML=t})),T("#dialog-error")}function q(e,t){UIkit.notification({message:e,status:t||"primary",pos:"bottom-center",timeout:3e3})}UIkit.util.on("#dialog-plot","shown",R),UIkit.util.on("#dialog-plot","hide",(()=>{V=!1})),window.addEventListener("resize",(()=>{V&&e("#dialog-plot").classList.contains("uk-open")&&R(),clearTimeout(P),P=setTimeout(f,10),C()}));let J=!1,_=!1;const X=e(".CodeMirror-scroll"),Z=e("#output");X.addEventListener("scroll",(()=>{J||(_=!0,Z.scrollTop=X.scrollTop),J=!1})),Z.addEventListener("scroll",(()=>{_||(J=!0,X.scrollTop=Z.scrollTop),_=!1,e("#scrollTop").style.display=e("#output").scrollTop>50?"block":"none"})),e("#scrollTop").addEventListener("click",(()=>{e("#output").scrollTop=0}));const K={clearButton:["command+d","ctrl+d"],printButton:["command+p","ctrl+p"],saveButton:["command+s","ctrl+s"],openButton:["command+o","ctrl+o"]};for(const[t,n]of Object.entries(K))Mousetrap.bindGlobal(n,(n=>{n.preventDefault(),0===e(".uk-open",!0).length&&e("#"+t).click()}));function Q(){setTimeout((()=>{l.send("altContextMenu")}),20)}function Y(t,n,o){n=+n;const i=a.getLine(n).trim(),r=e("#output").children[n].innerText,s=o?`${i} = ${r}`:`${r}`;navigator.clipboard.writeText(s),q(o?`Copied Line${n+1} with answer to clipboard.`:`Copied '${r}' to clipboard.`)}function ee(t,n){const o=a.listSelections();let i="";o.forEach((t=>{const o=[t.anchor.line,t.head.line],r=Math.min(...o),s=Math.max(...o)+1;for(let t=r;t<s;t++){const o=a.getLine(t).trim(),r=e("#output").children[t].innerText;i+=o?o.match(/^(#|\/\/)/)?n?`${o}\n`:"":n?`${o} = ${r}\n`:`${r}\n`:""}})),navigator.clipboard.writeText(i),q(n?"Copied selected lines with answers to clipboard.":"Copied selected answers to clipboard.")}function te(){if(""!==a.getValue()){let t="";a.eachLine((n=>{const o=a.getLineNumber(n);n=n.text.trim(),t+=n?n.match(/^(#|\/\/)/)?`${n}\n`:`${n} = ${e("#output").children[o].innerText}\n`:"\n"})),navigator.clipboard.writeText(t),q("Copied all calculations to clipboard.")}}c&&(a.on("contextmenu",(function(){setTimeout((()=>{const t=a.getCursor().line,n=a.getLine(t),o=e("#output").children[t].innerText,i=""===a.getValue(),r=n.length>0,s=a.somethingSelected(),c=a.listSelections().length>1||a.listSelections()[0].anchor.line!==a.listSelections()[0].head.line,p=""!==o&&"Error"!==o&&"Plot"!==o;l.send("mainContextMenu",t,i,r,s,c,p)}),20)})),i.on("contextmenu",Q),r.on("contextmenu",Q),e("#output").addEventListener("contextmenu",(function(e){const t=e.srcElement.getAttribute("line-no")||e.srcElement.parentElement.getAttribute("line-no"),n=e.srcElement.innerText,o=""===a.getValue(),i=null!==t&&""!==n&&"Error"!==n&&"Plot"!==n;l.send("outputContextMenu",t,o,i)})),e(".textBox",!0).forEach((e=>{e.addEventListener("contextmenu",Q)})),l.on("copyAnswer",Y),l.on("copyLineWithAnswer",Y),l.on("copySelectedAnswers",ee),l.on("copySelectedLinesWithAnswers",ee),l.on("copyAllCalculations",te)),c&&(l.send("checkUpdate"),l.on("notifyUpdate",(()=>{q('Updating Numara... <a class="notificationLink" onclick="document.querySelector(`#aboutButton`).click()">View update status</a>'),e("#notificationDot").style.display="block"})),l.on("updateStatus",((t,n)=>{"ready"===n?(e("#dialog-about-updateStatus").innerHTML="Restart Numara to finish updating.",e("#restartButton").style.display="inline-block",e("#dialog-about").classList.contains("uk-open")||q('Restart Numara to finish updating. <a class="notificationLink" onclick="document.querySelector(`#restartButton`).click()">Restart Now</a>')):e("#dialog-about-updateStatus").innerHTML=n})));const ne="1+2\n\n    # In addition to mathjs functions, you can do:\n    ans // Get last answer\n    total // Total up to this point\n    avg // Average up to this point\n    line4 // Get answer from a line#\n    subtotal // Subtotal last block\n\n    # Percentages:\n    10% of 20\n    40 + 30%\n\n    # Dates\n    today\n    now\n    today - 3 weeks\n    now + 36 hours - 2 days\n\n    # Currency conversion\n    1 usd to try\n    20 cad to usd\n\n    # Plot functions\n    f(x) = sin(x)\n    f(x) = 2x^2 + 3x - 5\n    ".replace(/^ +/gm,"");setTimeout((()=>{e(".CodeMirror-code").lastChild.scrollIntoView()}),250),setTimeout((()=>{a.focus()}),500)})();